<h1><%= @project.title %></h1>
<%= @project.description %></p>
<p>Project Owners: 

<% @owners.each do |owner| %>
  <%= owner.full_name%><%= ", " unless owner == @owners.last%>
<% end %>
</p>

<%= link_to "View and add collaborators", project_permissions_path(@project) %>

<p>Due date: <%= @project.human_time %> -- <%= link_to "Edit project details", edit_project_path(@project) %></p>

<h2>Tasks</h2>
<h3><%= link_to "Create a new section", new_project_section_path(@project) %> || <%= link_to "Add a task", new_project_task_path(@project) %></h3>

<% if @loose_tasks %>

<table>
    <tr>
    <th></th>
    <th>Task</th>
    <th>Deadline</th>
    <th>Assigned To</th>
    </tr>

  <% @loose_tasks.each do |t| %>
    <tr>
      <td>
        <div class="icon-container">
          <%# task complete button %>
          <% if t.status == "complete" %>
            <div class="completed icon"></div>
          <% else %>
              <%= render partial: '/tasks/complete_button', locals: { task: t } %>
          <% end %>
        </div>
      </td>

      <td>
        <div class="icon-container">
          <%= t.content %>
          <%# task edit button %>
          <%= render partial: '/tasks/edit_button', locals: { task: t }%>
          <%# task delete button %>
          <%= render partial: '/tasks/delete_button', locals: { task: t }%>
        </div>
      </td>

      <td>
      <% if t.deadline %>
        <%= t.human_time%>
      <% end %>
      </td>

      <td>
        <% if t.assignment %>
          <%= t.assignment.user.full_name %>
        <% else %>
          <%= form_with model: @assignment, url: '/assignments' do |f| %>
            <%= f.hidden_field :task_id, value: t.id %>
            <%= f.collection_select :user_id, @collaborators, :id, :first_name %>
            <%= f.submit "Assign" %>
          <% end %>
        <% end %>
      </td>
    </tr>
  <% end %>
  </table>
<% end %>

<% @sections.each do |section| %>
  <h3><%= section.name %></h3>

  <% if section.tasks %>

    <table>
    <tr>
    <th></th>
    <th>Task</th>
    <th>Deadline</th>
    <th>Assigned To</th>
    </tr>

    <% section.tasks.each do |t| %>
      <tr>
        <td>
          <div class="icon-container">
          <%# task complete button %>
          <% if t.status == "complete" %>
            <div class="completed icon"></div>
          <% else %>
              <%= render partial: '/tasks/complete_button', locals: { task: t } %>
          <% end %>
        </div>
        </td>

        <td>
          <div class="icon-container">
           <%= t.content %>
            <%# task edit button %>
            <%= render partial: '/tasks/edit_button', locals: { task: t }%>
            <%# task delete button %>
            <%= render partial: '/tasks/delete_button', locals: { task: t }%>
          </div>
        </td>

        <td>
        <% if t.deadline %>
          <%= t.human_time%>
        <% end %>
        </td>

        <td>
          <% if t.assignment %>
            <%= t.assignment.user.full_name %>
          <% else %>
            <%= form_with model: @assignment, url: '/assignments' do |f| %>
              <%= f.hidden_field :task_id, value: t.id %>
              <%= f.collection_select :user_id, @collaborators, :id, :first_name %>
              <%= f.submit "Assign" %>
            <% end %>
          <% end %>
        </td>
      </tr>
    <% end %>
    </table>
  <% end %>
<% end %>